generator client {
  provider     = "prisma-client"
  output       = "../src/generated/prisma"
  moduleFormat = "esm"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// AUTH MODELS

model User {
  id            String         @id @default(uuid())
  name          String
  email         String
  emailVerified Boolean
  image         String?
  createdAt     DateTime
  updatedAt     DateTime
  sessions      Session[]
  accounts      Account[]
  lists         List[]
  presents      Present[]
  picks         Pick[]
  favoriteLists FavoriteList[]

  @@unique([email])
  @@map("user")
}

model Session {
  id        String   @id @default(uuid())
  expiresAt DateTime
  token     String
  createdAt DateTime
  updatedAt DateTime
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@map("session")
}

model Account {
  id                    String    @id @default(uuid())
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime
  updatedAt             DateTime

  @@map("account")
}

model Verification {
  id         String    @id @default(uuid())
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime?
  updatedAt  DateTime?

  @@map("verification")
}

// BUSINESS MODELS

enum PresentStatus {
  free
  reserved
  purchased
}

enum ItemVisibility {
  public
  private
}

model Present {
  id          String         @id @default(uuid()) @map("_id")
  name        String
  description String?
  price       Int            @default(0)
  link        String?
  status      PresentStatus  @default(free)
  visibility  ItemVisibility @default(public)

  list   List?   @relation(fields: [listId], references: [id], onDelete: SetNull)
  listId String? @map("list_id")

  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String @map("user_id")

  picks Pick[]

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @map("updated_at")

  @@map("present")
}

model List {
  id            String         @id @default(uuid()) @map("_id")
  name          String
  description   String?
  visibility    ItemVisibility @default(public)
  dateEvent     DateTime?      @map("date_event")
  userId        String         @map("user_id")
  createdAt     DateTime       @default(now()) @map("created_at")
  updatedAt     DateTime       @default(now()) @map("updated_at")
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  presents      Present[]
  favoriteLists FavoriteList[]

  @@map("list")
}

enum PickAction {
  picked
  reserved
  purchased
}

model Pick {
  id        String     @id @default(uuid()) @map("_id")
  presentId String     @map("present_id")
  userId    String     @map("user_id")
  action    PickAction @default(picked)
  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @default(now()) @map("updated_at")
  present   Present    @relation(fields: [presentId], references: [id], onDelete: Cascade)
  user      User       @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, presentId], name: "unique_pick")
  @@map("pick")
}

model FavoriteList {
  id        String   @id @default(uuid()) @map("_id")
  listId    String   @map("list_id")
  userId    String   @map("user_id")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @default(now()) @map("updated_at")
  list      List     @relation(fields: [listId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, listId], name: "unique_favorite_list")
  @@map("favorite_list")
}
